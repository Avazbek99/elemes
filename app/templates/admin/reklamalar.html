{% extends "base.html" %}

{% block title %}{{ t('reklamalar') }}{% endblock %}

{% block content %}
<style>
.reklamalar-switch-input { position: absolute; width: 1px; height: 1px; padding: 0; margin: -1px; overflow: hidden; clip: rect(0,0,0,0); border: 0; }
.reklamalar-switch-slider { position: relative; display: inline-block; width: 2.75em; height: 1.4em; background-color: #dee2e6; border-radius: 2em; flex-shrink: 0; transition: background-color 0.15s, transform 0.15s; cursor: pointer; }
.reklamalar-switch-slider::before { content: ''; position: absolute; top: 0.15em; left: 0.15em; width: 1.1em; height: 1.1em; background: #fff; border-radius: 50%; box-shadow: 0 0.125rem 0.25rem rgba(0,0,0,0.2); transition: transform 0.15s; }
.reklamalar-switch-input:checked + .reklamalar-switch-slider { background-color: #0ea5e9; }
.reklamalar-switch-input:checked + .reklamalar-switch-slider::before { transform: translateX(1.35em); }
</style>
<div class="space-y-6">
    <div class="flex flex-col sm:flex-row sm:items-center sm:justify-between gap-4">
        <div>
            <h1 class="text-2xl font-bold text-gray-900">{{ t('reklamalar') }}</h1>
            <p class="text-gray-500 mt-1">{{ t('reklamalar_description') }}</p>
        </div>
        <a href="{{ url_for('admin.flash_xabar_edit') }}" class="inline-flex items-center gap-2 px-5 py-2.5 bg-primary-600 hover:bg-primary-700 text-white font-medium rounded-xl transition-colors shadow-lg shadow-primary-500/25">
            <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                    d="M11 5.882V19.24a1.76 1.76 0 01-3.417.592l-2.147-6.15M18 13a3 3 0 100-6M5.436 13.683A4.001 4.001 0 017 6h1.832c4.1 0 7.625-1.234 9.168-3v14c-1.543-1.766-5.067-3-9.168-3H7a3.988 3.988 0 01-1.564-.317z" />
            </svg>
            {{ t('flash_xabar_qoshish') }}
        </a>
    </div>

    {% if flash_messages %}
    {% set lang_labels = {'uz': "O'zbek", 'ru': 'Русский', 'en': 'English'} %}
    {% for fm in flash_messages %}
    {% set has_any = fm.text_uz or fm.text_ru or fm.text_en %}
    <div class="bg-white rounded-xl p-4 border border-gray-200 flex flex-col sm:flex-row sm:items-start sm:justify-between gap-4 shadow-sm">
        <div class="min-w-0 flex-1">
            <p class="text-sm font-medium text-gray-600 mb-1">{{ t('flash_xabar_current') }} {% if flash_messages|length > 1 %}#{{ loop.index }}{% endif %}</p>
            {% if has_any %}
            {% for lang in site_langs %}
            {% set txt = fm.get_text(lang) %}
            {% if txt %}
            <p class="text-gray-700 mt-2"><span class="text-xs font-medium text-gray-500">({{ lang_labels.get(lang, lang) }})</span> {{ txt }}</p>
            {% endif %}
            {% endfor %}
            {% else %}
            <p class="text-gray-500 italic">{{ t('flash_xabar_not_set') }}</p>
            {% endif %}
            {% if fm.url %}
            <p class="text-sm text-primary-600 mt-1">{{ t('flash_xabar_url') }}: <a href="{{ fm.url }}" target="_blank" rel="noopener" class="underline">{{ fm.url }}</a></p>
            {% endif %}
            {% if fm.date_from or fm.date_to %}
            <p class="text-sm text-gray-500 mt-2">{{ t('start_date') }}: {{ fm.date_from.strftime('%Y-%m-%d') if fm.date_from else '—' }} — {{ t('end_date') }}: {{ fm.date_to.strftime('%Y-%m-%d') if fm.date_to else '—' }}</p>
            {% endif %}
        </div>
        <div class="flex flex-col items-end flex-shrink-0">
            <p class="text-xs font-medium text-gray-500 uppercase tracking-wide mb-2">{{ t('curriculum_table_actions') }}</p>
            <div class="flex items-center gap-1">
                <a href="{{ url_for('admin.flash_xabar_edit', fm_id=fm.id) }}" class="p-2 text-blue-600 hover:bg-blue-50 rounded-lg transition-colors" title="{{ t('edit') }}">
                    <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M11 5H6a2 2 0 00-2 2v11a2 2 0 002 2h11a2 2 0 002-2v-5m-1.414-9.414a2 2 0 112.828 2.828L11.828 15H9v-2.828l8.586-8.586z"/></svg>
                </a>
                <form action="{{ url_for('admin.delete_flash_message', fm_id=fm.id) }}" method="POST" class="inline delete-flash-form" data-confirm="{{ t('flash_xabar_confirm_delete') }}">
                    <input type="hidden" name="csrf_token" value="{{ csrf_token() }}"/>
                    <button type="submit" class="p-2 text-red-600 hover:bg-red-50 rounded-lg transition-colors" title="{{ t('delete') }}">
                        <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"/></svg>
                    </button>
                </form>
                <form action="{{ url_for('admin.toggle_flash_message', fm_id=fm.id) }}" method="POST" class="inline">
                    <input type="hidden" name="csrf_token" value="{{ csrf_token() }}"/>
                    <label class="cursor-pointer inline-flex items-center">
                        <input type="checkbox" {% if fm.enabled %}checked{% endif %} class="reklamalar-switch-input" onclick="this.form.submit()">
                        <span class="reklamalar-switch-slider"></span>
                    </label>
                </form>
            </div>
        </div>
    </div>
    {% endfor %}
    {% else %}
    <div class="bg-amber-50 rounded-xl p-4 border border-amber-200">
        <p class="text-amber-800">{{ t('flash_xabar_not_set') }}</p>
    </div>
    {% endif %}
</div>
<script>
document.addEventListener('DOMContentLoaded', function() {
    document.querySelectorAll('.delete-flash-form').forEach(function(form) {
        form.addEventListener('submit', function(e) {
            var msg = form.getAttribute('data-confirm');
            if (!confirm(msg || "O'chirishni tasdiqlaysizmi?")) {
                e.preventDefault();
            }
        });
    });
});
</script>
{% endblock %}
